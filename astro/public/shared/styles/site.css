:root {
  color-scheme: dark;
  --bg:#05060f;
  --fg:#f4efe8;
  --muted:#b3ad9f;
  --accent:#ff8a5c;
  --panel:rgba(11,12,20,.82);
  --border:rgba(255,255,255,.08);
  --paper:#0c0f18;
  --sand:rgba(255,255,255,.05);
  --ink:var(--fg);
  --line:rgba(255,255,255,.12);
  --radius:18px;
  --shadow:0 30px 80px rgba(5,8,20,.45);
  --nav-height:72px;
  --nav-offset:0px;
  --nav-stack:var(--nav-height);
  --gutter:clamp(20px,5vw,72px);
  --max:min(1260px, calc(100% - 32px));
}

body.is-light {
  color-scheme: light;
  --bg:#f6f3ee;
  --fg:#1f1f1f;
  --muted:#6a6257;
  --accent:#9a7b43;
  --panel:rgba(255,255,255,.92);
  --border:rgba(0,0,0,.08);
  --paper:#fff;
  --sand:#f2ece3;
  --ink:var(--fg);
  --line:rgba(0,0,0,.08);
  --shadow:0 18px 50px rgba(0,0,0,.12);
  background:#f8f4ec;
}

* {
  box-sizing:border-box;
}

html, body {
  margin:0;
  min-height:100%;
  font-size:16px;
  line-height:1.6;
  font-family:"Palatino Linotype", Palatino, "Book Antiqua", "URW Palladio L", serif;
  color:var(--fg);
  background:radial-gradient(circle at 12% 18%, rgba(32,36,56,.9), #05060f 70%);
  transition:background 0.4s ease, color 0.4s ease;
}

body {
  min-height:100vh;
}

a {
  color:inherit;
  text-decoration:none;
}

img {
  max-width:100%;
  height:auto;
  display:block;
}

.wrap {
  width:100%;
  max-width:var(--max);
  margin:0 auto;
  padding:24px var(--gutter);
}

.site-nav {
  padding:24px var(--gutter) 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  position:sticky;
  top:0;
  z-index:10;
  background:rgba(5,6,15,.82);
  backdrop-filter:blur(22px);
  border-bottom:1px solid var(--border);
}

body.is-light .site-nav {
  background:rgba(255,255,255,.92);
  border-bottom:1px solid var(--border);
}

.brand {
  text-transform:uppercase;
  letter-spacing:0.3em;
  font-size:1.05rem;
  color:var(--muted);
}

.brand strong {
  letter-spacing:0.1em;
  color:var(--fg);
}

.site-nav nav {
  display:flex;
  gap:1.25rem;
  align-items:center;
}

.site-nav nav a {
  text-transform:uppercase;
  letter-spacing:0.2em;
  font-size:0.88rem;
  font-weight:550;
  color:var(--muted);
}

.site-nav nav a.active {
  color:var(--fg);
}

body.is-light .site-nav nav a {
  color:var(--muted);
}

.theme-toggle {
  border:1px solid var(--border);
  background:transparent;
  color:var(--fg);
  border-radius:999px;
  width:36px;
  height:36px;
  font-size:1rem;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:transform 0.2s ease, background 0.2s ease;
}

.theme-toggle:hover {
  background:rgba(255,255,255,.08);
}

.theme-toggle:focus-visible {
  outline:2px solid var(--accent);
  outline-offset:2px;
}

.shell-main {
  padding:var(--nav-stack) 0 96px;
}

.shell-main.wrap {
  padding:var(--nav-stack) var(--gutter) 96px;
}

.shell-main > .wrap {
  padding-left:var(--gutter);
  padding-right:var(--gutter);
}

.hero {
  max-width:760px;
  margin:0 auto 40px;
  text-align:left;
}

.hero h1 {
  font-size:clamp(2.5rem, 4vw, 3.7rem);
  margin:0 0 12px;
}

.hero p {
  margin:0;
  color:var(--muted);
  font-size:1.05rem;
}

.hero-cover {
  position:relative;
  border-radius:28px;
  overflow:hidden;
  padding:80px 0;
  background:url("../images/rome-4k-background.jpg") center/cover no-repeat;
  box-shadow:var(--shadow);
}

.hero-cover::before {
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(135deg,rgba(5,5,15,.75),rgba(6,6,14,.35));
}

.hero-cover .hero-content {
  position:relative;
  z-index:1;
  display:flex;
  flex-direction:column;
  gap:18px;
  padding:0 var(--gutter);
  color:var(--fg);
}

button#cta {
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:10px 18px;
  cursor:pointer;
  color:var(--fg);
  text-transform:uppercase;
  letter-spacing:0.2em;
}

.foot {
  border-top:1px solid var(--border);
  padding:32px var(--gutter);
  text-align:center;
  color:var(--muted);
}

/* Leaflet permanent labels */
.map-label {
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:12px;
  padding:4px 8px;
  font-size:14.5px;
  color:var(--fg);
  box-shadow:var(--shadow);
}
.leaflet-tooltip-top:before { border-top-color:var(--border); }

/* Map gallery */
.map-gallery { padding: 64px 0 40px; background: var(--paper); }
.map-gallery .wrap { position: relative; z-index: 1; }
.gallery-header { display:flex; justify-content:space-between; align-items:center; margin:4px 0 12px; }
.gallery-header h2 { margin:0; }
.controls { display:flex; align-items:center; gap:10px; }
.controls .muted { color:var(--muted); font-size:14px; }
.btn { display:inline-block; padding:8px 12px; border:1px solid var(--line); border-radius:var(--radius); background:var(--sand); cursor:pointer; color:var(--fg); transition:background 0.25s ease, color 0.25s ease, border-color 0.25s ease; }
.btn:hover { filter:brightness(.98); }

/* Slides */
.slides { position:relative; overflow:hidden; }
.slide { min-height: 520px; }
.slide:not(.active) { display:none; }
.slide h3 { margin:6px 0 10px; }

/* Map box */
.map { width:100%; height:420px; border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); background:var(--paper); }
.legend { list-style:none; padding:8px 0 0; margin:0; color:var(--muted); display:flex; gap:16px; }

/* Random / NYT blocks */
.random-page h1 {
  margin-top: 0;
}
.random-page .lead{
  margin:4px 0 24px;
  color:var(--muted);
  max-width:520px;
}
.random-feed{
  display:flex;
  flex-direction:column;
  gap:28px;
  padding-bottom:80px;
}
.nyt-card{
  border-top:3px double var(--line);
  padding-top:24px;
  max-width:640px;
}
.nyt-card__link{
  display:flex;
  flex-direction:column;
  gap:12px;
  color:inherit;
  text-decoration:none;
}
.nyt-card__title{
  font-size:clamp(26px,4vw,34px);
  margin:0;
}
.nyt-card__dek{
  margin:0;
  color:var(--muted);
  line-height:1.7;
}
.nyt-card__cta{
  font-size:14px;
  letter-spacing:0.08em;
  text-transform:uppercase;
  color:var(--accent);
}
.nyt-card__link:hover .nyt-card__cta{
  text-decoration:underline;
}

/* Projects gallery */
.projects-page{
  display:flex;
  flex-direction:column;
  gap:40px;
  padding-bottom:120px;
}
.projects-header{
  display:flex;
  flex-direction:column;
  gap:14px;
  max-width:540px;
}
.projects-lead{
  margin:0;
  color:var(--muted);
  font-size:1.1rem;
  line-height:1.7;
}
.projects-grid{
  display:grid;
  gap:36px;
  grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
}
.projects-grid--two-up{
  grid-template-columns:repeat(2,minmax(0,1fr));
}
.projects-grid--two-up > .project-card:last-child:nth-child(odd){
  grid-column:1 / -1;
}
@media(max-width:880px){
  .projects-grid--two-up{
    grid-template-columns:1fr;
  }
}
.project-card{
  position:relative;
  display:flex;
  flex-direction:column;
  justify-content:flex-end;
  min-height:360px;
  padding:0;
  border-radius:26px;
  overflow:hidden;
  text-decoration:none;
  color:#f4f0e8;
  box-shadow:0 26px 48px rgba(0,0,0,.16);
  transition:transform .45s ease, box-shadow .45s ease;
  isolation:isolate;
}
.project-card img{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  filter:saturate(1.1);
  transform:scale(1.02);
  transition:transform .6s ease, filter .6s ease;
  z-index:-2;
}
.project-card::after{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(200deg,rgba(6,5,3,0) 20%,rgba(6,5,3,.8) 100%);
  transition:opacity .45s ease;
  opacity:0;
  z-index:-1;
}
.project-card__overlay{
  position:relative;
  padding:32px 34px;
  display:flex;
  flex-direction:column;
  gap:12px;
  opacity:0;
  visibility:hidden;
  transform:translateY(18px);
  transition:opacity .35s ease, transform .35s ease;
  pointer-events:none;
}
.project-card__tag{
  font-size:12px;
  letter-spacing:.28em;
  text-transform:uppercase;
  color:rgba(244,240,233,.7);
}
.project-card__title{
  margin:0;
  font-size:clamp(26px,4vw,34px);
}
.project-card__desc{
  margin:0;
  max-width:420px;
  color:rgba(244,240,233,.78);
  line-height:1.7;
}
.project-card__cta{
  font-size:14px;
  letter-spacing:.14em;
  text-transform:uppercase;
  color:rgba(244,240,233,.8);
}
.project-card:hover,
.project-card:focus-within{
  transform:translateY(-8px) scale(1.01);
  box-shadow:0 32px 60px rgba(0,0,0,.2);
}
.project-card:hover img,
.project-card:focus-within img{
  transform:scale(1.06);
  filter:saturate(1.2);
}
.project-card:hover::after,
.project-card:focus-within::after{
  opacity:.92;
}
.project-card:hover .project-card__overlay,
.project-card:focus-within .project-card__overlay{
  opacity:1;
  visibility:visible;
  transform:translateY(0);
}
.project-card--light{
  color:#1f1a15;
}
.project-card--light::after{
  background:linear-gradient(200deg,rgba(244,240,233,0) 30%,rgba(244,240,233,.85) 100%);
}
.project-card--light .project-card__tag{
  color:rgba(45,39,31,.6);
}
.project-card--light .project-card__desc{
  color:rgba(40,34,28,.75);
}
.project-card--light .project-card__cta{
  color:rgba(38,32,26,.7);
}

@media(max-width:680px){
  .project-card{
    min-height:280px;
  }
  .project-card__overlay{
    padding:24px 26px;
  }
}

/* Project detail */
.project-detail{
  display:flex;
  flex-direction:column;
  gap:36px;
  padding-bottom:120px;
}
.project-detail__header{
  display:flex;
  flex-direction:column;
  gap:12px;
  max-width:640px;
}
.project-detail__back{
  align-self:flex-start;
  display:inline-flex;
  gap:8px;
  align-items:center;
  text-decoration:none;
  font-size:0.95rem;
  color:var(--muted);
  letter-spacing:0.08em;
  text-transform:uppercase;
}
.project-detail__back:hover{
  color:var(--ink);
}
.project-detail__lead{
  margin:0;
  color:var(--muted);
  font-size:1.05rem;
  line-height:1.7;
}
.project-detail__body{
  display:flex;
  flex-direction:column;
  gap:28px;
}
.project-detail__notes-layout{
  display:flex;
  flex-wrap:wrap;
  gap:24px;
  align-items:flex-start;
}
.project-detail__widgets{
  display:flex;
  flex-direction:column;
  gap:24px;
  flex:0 1 960px;
}
.project-detail__notes-list{
  flex:1 1 360px;
  display:flex;
  flex-direction:column;
  gap:14px;
}
.project-detail__metar{
  flex:0 0 320px;
  max-width:360px;
  width:100%;
  min-height:435px;
  border-radius:22px;
  border:1px solid var(--line);
  box-shadow:var(--shadow);
  background:#fff;
  overflow:hidden;
}
.project-detail__lightmap{
  flex:1 1 800px;
  max-width:100%;
  overflow:auto;
}
.project-detail__embed{
  border-radius:28px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.4);
  box-shadow:0 24px 50px rgba(0,0,0,.12);
  background:#fff;
}
.project-detail__embed gradio-app{
  display:block;
  width:100%;
  min-height:760px;
  border:0;
  background:#fff;
}
.project-detail__embed iframe{
  display:block;
  width:100%;
  height:clamp(760px,90vh,1080px);
  border:0;
  background:#fff;
}
.project-detail__grid{
  display:grid;
  gap:24px;
  grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
}
.project-detail__stack{
  display:flex;
  flex-direction:column;
  gap:32px;
}
.project-detail__grid--stack{
  grid-template-columns:1fr;
  gap:32px;
}
.project-detail__panel{
  background:#fff;
  border-radius:22px;
  padding:24px;
  border:1px solid var(--line);
  box-shadow:var(--shadow);
  display:flex;
  flex-direction:column;
  gap:18px;
}
.project-detail__panel--night{
  background:#110b16;
  border-color:rgba(255,215,185,.25);
  color:#f7efe4;
  box-shadow:0 36px 68px rgba(3,2,6,.45);
}
.project-detail__panel--night h2{
  color:#ffe2a8;
}
.project-detail__panel--night iframe{
  background:#05060e;
}
.project-detail__panel h2{
  margin:0;
  font-size:1.15rem;
}
.project-detail__panel iframe{
  width:100%;
  min-height:420px;
  border:0;
  border-radius:16px;
  background:#fff;
}
.project-detail__panel--square iframe{
  aspect-ratio:1 / 1;
  min-height:0;
  height:auto;
}
.project-detail__note{
  margin:0;
  color:var(--muted);
  font-size:0.98rem;
}
.project-detail__note--loud{
  font-size:1.1rem;
}
.project-detail__note a{color:inherit;}
.project-detail__note a:hover{text-decoration:underline;}

/* Essay detail */
.essay-page{
  padding-top:calc(var(--nav-stack) + 56px);
  padding-bottom:120px;
}
.essay{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:24px;
  box-shadow:var(--shadow);
  padding:48px clamp(24px,6vw,64px);
  color:var(--fg);
}
.essay-header{
  display:flex;
  flex-direction:column;
  gap:18px;
  margin-bottom:36px;
}
.essay-label{
  text-transform:uppercase;
  letter-spacing:0.24em;
  font-size:12px;
  color:var(--muted);
  margin:0;
}
.essay h1{
  font-size:clamp(30px,5vw,44px);
  margin:0;
}
.essay-subhead{
  margin:0;
  color:var(--muted);
  font-size:18px;
  line-height:1.7;
}
.essay-body{
  display:flex;
  flex-direction:column;
  gap:20px;
  font-size:18px;
  line-height:1.8;
  color:var(--fg);
}
.essay-body h2,
.essay-body h3,
.essay-body h4{
  margin-top:40px;
  margin-bottom:12px;
  color:var(--fg);
}
.essay-body h3{font-size:24px;}
.essay-body h4{font-size:20px;}
.essay-body p{margin:0;}
.essay-body ul,
.essay-body ol{
  margin:0;
  padding-left:26px;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.essay-body table{
  width:100%;
  border-collapse:collapse;
  font-size:16px;
  margin:12px 0;
  background:var(--paper);
  border-radius:12px;
  overflow:hidden;
}
.essay-body table th,
.essay-body table td{
  padding:12px 14px;
  border-bottom:1px solid var(--line);
  text-align:left;
}
.essay-body table tr:last-child td{border-bottom:none;}
.essay-body strong{color:var(--fg);}
.essay-loading,
.essay-error{
  margin:0;
  color:var(--muted);
}
.essay-outline{
  display:flex;
  flex-direction:column;
  gap:18px;
  margin-top:12px;
}
.essay-outline__item{
  border:1px solid var(--line);
  border-radius:20px;
  background:var(--panel);
  box-shadow:var(--shadow);
  overflow:hidden;
}
body.is-light .essay-outline__item{
  background:var(--paper);
}
.essay-outline__item summary{
  padding:18px 24px;
  margin:0;
  list-style:none;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:16px;
  font-size:1.05rem;
  font-weight:600;
  color:var(--fg);
}
.essay-outline__item summary::-webkit-details-marker{
  display:none;
}
.essay-outline__chevron{
  transition:transform .2s ease;
  font-size:1.1rem;
  color:var(--muted);
}
.essay-outline__item[open] .essay-outline__chevron{
  transform:rotate(180deg);
}
.essay-outline__body{
  padding:0 24px 24px;
  border-top:1px solid var(--line);
  display:flex;
  flex-direction:column;
  gap:16px;
  color:var(--fg);
}
.essay-outline__body :global(p){
  margin:0;
}
.essay-outline__body :global(ul),
.essay-outline__body :global(ol){
  margin:0;
  padding-left:22px;
}
.essay-outline__body :global(h3),
.essay-outline__body :global(h4){
  margin:16px 0 6px;
  color:var(--fg);
}
.essay-outline__source{
  display:none;
}

/* Lux gallery */
.lux-page{
  padding-top:var(--nav-stack);
  display:flex;
  flex-direction:column;
  gap:24px;
}
.lux-intro{
  padding:0 var(--gutter) 32px;
}
.lux-intro .lead{
  margin:12px 0 0;
  max-width:560px;
  color:var(--muted);
}
